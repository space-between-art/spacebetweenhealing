        }
        
        // ===== API Call =====
        async function sendToAPI(userMessage) {
            conversationHistory.push({ role: 'user', content: userMessage });
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        system: SYSTEM_PROMPT,
                        messages: conversationHistory
                    })
                });
                
                const data = await response.json();
                const assistantMessage = data.content[0].text;
                conversationHistory.push({ role: 'assistant', content: assistantMessage });
                
                return assistantMessage;
            } catch (error) {
                console.error('API Error:', error);
                return 'æŠ±æ­‰ï¼Œæˆ‘æš«æ™‚ç„¡æ³•å›æ‡‰ã€‚è«‹ç¨å¾Œå†è©¦ï¼Œæˆ–ç›´æ¥è¯ç¹«æˆ‘å€‘ï¼šhello@spacebetweenhealing.com ğŸ’Œ';
            }
        }
        
        // ===== Message Handling =====
        async function sendMessage(text = null) {
            const message = text || messageInput.value.trim();
            if (!message) return;
            
            // Add user message
            const userMsgEl = createMessageElement(message, 'user');
            chatContainer.appendChild(userMsgEl);
            
            // Clear input
            messageInput.value = '';
            autoResizeTextarea();
            sendBtn.disabled = true;
            
            // Show typing indicator
            const typingEl = createTypingIndicator();
            chatContainer.appendChild(typingEl);
            scrollToBottom();
            
            // Get AI response
            const response = await sendToAPI(message);
            
            // Remove typing indicator
            typingEl.remove();
            
            // Add assistant message
            const assistantMsgEl = createMessageElement(response, 'assistant');
            chatContainer.appendChild(assistantMsgEl);
            scrollToBottom();
        }
        
        function sendQuickReply(text) {
            sendMessage(text);
        }
        
        // ===== Submit Summary =====
        async function submitSummary() {
            const name = document.getElementById('contactName').value.trim();
            const email = document.getElementById('contactEmail').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            
            if (!name || !email) {
                alert('è«‹å¡«å¯«åå­—å’Œ Email');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email åœ°å€');
                return;
            }
            
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>é€å‡ºä¸­...</span>';
            
            // Prepare the summary data
            const summaryCard = document.getElementById('summaryCard');
            const summaryItems = summaryCard.querySelectorAll('.summary-item');
            let summaryText = '';
            summaryItems.forEach(item => {
                const label = item.querySelector('.summary-label').textContent;
                const value = item.querySelector('.summary-value').textContent;
                summaryText += `${label}: ${value}\n`;
            });
            
            // Prepare conversation log
            const conversationLog = conversationHistory.map(msg => 
                `[${msg.role === 'user' ? 'è¨ªå®¢' : 'å…‰å…‰'}]: ${msg.content}`
            ).join('\n\n');
            
            // Create mailto link or use form submission
            const subject = encodeURIComponent(`[å…‰å…‰è½‰ä»‹] æ–°è«®è©¢éœ€æ±‚ - ${name}`);
            const body = encodeURIComponent(`
=== è¨ªå®¢è³‡æ–™ ===
å§“åï¼š${name}
Emailï¼š${email}
é›»è©±ï¼š${phone || 'æœªæä¾›'}

=== éœ€æ±‚æ‘˜è¦ ===
${summaryText}

=== å°è©±ç´€éŒ„ ===
${conversationLog}

---
æ­¤è¨Šæ¯ç”±å…‰å…‰ AI å°åŠ©ç†è‡ªå‹•æ•´ç†
            `);
            
            // Option 1: Open email client
            window.location.href = `mailto:hello@spacebetweenhealing.com?subject=${subject}&body=${body}`;
            
            // Show success state
            setTimeout(() => {
                summaryCard.innerHTML = `
                    <div class="success-message">
                        <div class="success-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                        </div>
                        <h4>å·²æº–å‚™å¥½é€å‡ºï¼</h4>
                        <p>è«‹åœ¨ Email æ‡‰ç”¨ç¨‹å¼ä¸­é»æ“Šã€Œé€å‡ºã€ã€‚<br>è¨­è¨ˆå¸«æœƒåœ¨ 1-2 å€‹å·¥ä½œå¤©å…§å›è¦†ä½  âœ¨</p>
                    </div>
                `;
                scrollToBottom();
            }, 500);
        }
        
        // ===== Initial Message =====
        function showInitialMessage() {
            const welcomeMsg = `ä½ å¥½ï¼æˆ‘æ˜¯å…‰å…‰ âœ¨

æ­¡è¿ä¾†åˆ°éš™å…‰è¨­è¨ˆçš„æœƒå®¢å®¤ï½

æˆ‘æ˜¯é€™è£¡çš„ AI å°åŠ©ç†ï¼Œå¯ä»¥å¹«ä½ ï¼š
â€¢ èŠèŠå“ç‰Œä¸Šé‡åˆ°çš„å›°æ“¾
â€¢ é‡æ¸…ä½ æƒ³è¦çš„æ–¹å‘
â€¢ å›ç­”é—œæ–¼æˆ‘å€‘æœå‹™çš„å•é¡Œ

èŠå®Œä¹‹å¾Œï¼Œæˆ‘æœƒæ•´ç†é‡é»è®“è¨­è¨ˆå¸«è·Ÿé€²ã€‚

æœ‰ä»€éº¼æƒ³èŠçš„å—ï¼Ÿ`;
            
            const quickReplies = [
                'æˆ‘çš„å“ç‰Œå¥½åƒæœ‰é»å•é¡Œ...',
                'æƒ³äº†è§£ä½ å€‘çš„æœå‹™',
                'ä¸å¤ªç¢ºå®šè‡ªå·±éœ€è¦ä»€éº¼'
            ];
            
            const msgEl = createMessageElement(welcomeMsg, 'assistant', { quickReplies });
            chatContainer.appendChild(msgEl);
        }
        
        // ===== Event Listeners =====
        messageInput.addEventListener('input', () => {
            autoResizeTextarea();
            sendBtn.disabled = !messageInput.value.trim();
        });
        
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (messageInput.value.trim()) {
                    sendMessage();
                }
            }
        });
        
        sendBtn.addEventListener('click', () => sendMessage());
        
        // ===== Initialize =====
        showInitialMessage();
    </script>
</body>
</html>
