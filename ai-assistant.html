<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½åˆ†æåŠ©ç† å…‰å…‰ | Space Between Healing</title>
    <meta name="description" content="AI æ™ºèƒ½åˆ†æåŠ©ç† å…‰å…‰ã€‚24å°æ™‚ç‚ºä½ è§£ç­”å“ç‰Œå›°æƒ‘ï¼Œæä¾›åˆæ­¥çš„å“ç‰Œè¨ºæ–·èˆ‡å»ºè­°ã€‚">
    <link rel="canonical" href="https://spacebetweenhealing.com/ai-assistant">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,400&family=Outfit:wght@300;400;500;600&family=Noto+Serif+TC:wght@300;400;500&family=Noto+Serif+SC:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a0a;
            --bg-dark: #111;
            --bg-card: #161616;
            --gold: #d4a574;
            --gold-light: #e8c9a0;
            --sage: #a0b89c;
            --cream: #f5efe6;
            --glow-gold: rgba(212,165,116,0.35);
            --glow-sage: rgba(160,184,156,0.25);
            --text-primary: #f5efe6;
            --text-secondary: rgba(245,239,230,0.7);
            --text-muted: rgba(245,239,230,0.45);
            --font-display: 'Cormorant Garamond', serif;
            --font-body: 'Outfit', sans-serif;
            --font-zh: 'Noto Serif TC', serif;
            --font-zh-sc: 'Noto Serif SC', serif;
            --ease: cubic-bezier(0.16,1,0.3,1);
        }
        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        html { scroll-behavior:smooth; }
        body { font-family:var(--font-body); background:var(--bg-deep); color:var(--text-primary); line-height:1.7; overflow-x:hidden; min-height:100vh; }
        [data-lang="zh-TW"] .zh { font-family:var(--font-zh); }
        [data-lang="zh-CN"] .zh { font-family:var(--font-zh-sc); }
        .lang-content { display:none; }
        .lang-content.active { display:block; }
        span.lang-content { display:none; }
        span.lang-content.active { display:inline; }

        .ambient { position:fixed; inset:0; z-index:-1; pointer-events:none; }
        .orb { position:absolute; border-radius:50%; filter:blur(100px); opacity:0.4; }
        .orb-1 { width:500px; height:500px; background:radial-gradient(circle,var(--glow-gold) 0%,transparent 70%); top:-15%; left:-10%; animation:float 25s ease-in-out infinite; }
        .orb-2 { width:400px; height:400px; background:radial-gradient(circle,var(--glow-sage) 0%,transparent 70%); bottom:-10%; right:-5%; animation:float 30s ease-in-out infinite reverse; }
        @keyframes float { 0%,100%{transform:translate(0,0)} 50%{transform:translate(30px,-20px)} }

        /* Nav */
        .nav { position:fixed; top:0; left:0; right:0; z-index:1000; padding:1rem 4vw; display:flex; justify-content:space-between; align-items:center; background:rgba(10,10,10,0.95); backdrop-filter:blur(20px); border-bottom:1px solid rgba(212,165,116,0.1); }
        .nav-logo { font-family:var(--font-display); font-size:1.1rem; letter-spacing:0.2em; color:var(--gold); text-decoration:none; font-weight:500; }
        .nav-right { display:flex; align-items:center; gap:1.5rem; }
        .nav-links { display:flex; gap:0.3rem; list-style:none; }
        .nav-links li a { display:block; font-size:0.8rem; color:var(--text-secondary); text-decoration:none; transition:all 0.3s; padding:0.5rem 0.8rem; border-radius:8px; }
        .nav-links li a:hover { color:var(--gold); background:rgba(212,165,116,0.1); }
        .nav-links li a.active { color:var(--gold); background:rgba(212,165,116,0.15); }
        .lang-selector { position:relative; }
        .lang-btn { display:flex; align-items:center; gap:0.4rem; padding:0.5rem 1rem; background:rgba(212,165,116,0.1); border:1px solid rgba(212,165,116,0.25); border-radius:100px; color:var(--gold); font-size:0.8rem; cursor:pointer; transition:all 0.3s; font-weight:500; }
        .lang-btn:hover { background:rgba(212,165,116,0.2); border-color:var(--gold); }
        .lang-btn svg { width:12px; height:12px; transition:transform 0.3s; }
        .lang-selector.open .lang-btn svg { transform:rotate(180deg); }
        .lang-dropdown { position:absolute; top:calc(100% + 8px); right:0; min-width:140px; background:var(--bg-card); border:1px solid rgba(212,165,116,0.2); border-radius:12px; overflow:hidden; opacity:0; visibility:hidden; transform:translateY(-10px); transition:all 0.3s var(--ease); z-index:100; box-shadow:0 10px 40px rgba(0,0,0,0.4); }
        .lang-selector.open .lang-dropdown { opacity:1; visibility:visible; transform:translateY(0); }
        .lang-option { display:flex; align-items:center; gap:0.5rem; width:100%; padding:0.75rem 1rem; background:none; border:none; color:var(--text-secondary); font-size:0.85rem; text-align:left; cursor:pointer; transition:all 0.2s; }
        .lang-option:hover { background:rgba(212,165,116,0.1); color:var(--gold); }
        .lang-option.active { color:var(--gold); }

        /* Mobile Nav */
        .mobile-toggle { display:none; flex-direction:column; gap:5px; background:none; border:none; cursor:pointer; padding:5px; }
        .mobile-toggle span { display:block; width:22px; height:2px; background:var(--gold); transition:all 0.3s; }
        @media (max-width:900px) {
            .nav-links { display:none; }
            .mobile-toggle { display:flex; }
        }

        /* Main Container */
        .main-container { min-height:100vh; display:flex; flex-direction:column; padding-top:80px; }
        
        /* Page Header */
        .page-header { padding:4rem 4vw 2rem; text-align:center; }
        .assistant-icon { width:80px; height:80px; margin:0 auto 1.5rem; background:linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 10px 40px var(--glow-gold); animation:pulse 3s ease-in-out infinite; }
        @keyframes pulse { 0%,100%{box-shadow:0 10px 40px var(--glow-gold);} 50%{box-shadow:0 15px 60px var(--glow-gold);} }
        .assistant-icon svg { width:40px; height:40px; color:var(--bg-deep); }
        .page-title { font-family:var(--font-display); font-size:clamp(2rem,5vw,3rem); font-weight:300; margin-bottom:0.75rem; }
        .page-title .highlight { color:var(--gold); font-style:italic; }
        .page-subtitle { font-size:1rem; color:var(--text-secondary); max-width:500px; margin:0 auto; }

        /* Chat Language Selector */
        .chat-lang-selector { display:flex; justify-content:center; gap:0.75rem; margin:2rem auto; padding:0.5rem; background:rgba(212,165,116,0.05); border:1px solid rgba(212,165,116,0.1); border-radius:100px; max-width:fit-content; }
        .chat-lang-btn { padding:0.6rem 1.2rem; background:transparent; border:none; color:var(--text-secondary); font-size:0.85rem; border-radius:100px; cursor:pointer; transition:all 0.3s; font-weight:500; }
        .chat-lang-btn:hover { color:var(--gold); }
        .chat-lang-btn.active { background:var(--gold); color:var(--bg-deep); }

        /* Chat Container */
        .chat-container { flex:1; max-width:800px; width:100%; margin:0 auto; padding:0 4vw 2rem; display:flex; flex-direction:column; }
        
        .chat-window { flex:1; background:rgba(22,22,22,0.8); border:1px solid rgba(212,165,116,0.1); border-radius:24px; padding:1.5rem; min-height:400px; max-height:60vh; overflow-y:auto; margin-bottom:1.5rem; }
        
        .chat-messages { display:flex; flex-direction:column; gap:1rem; }
        
        .message { max-width:85%; padding:1rem 1.25rem; border-radius:20px; animation:fadeIn 0.3s ease; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
        
        .message.assistant { align-self:flex-start; background:rgba(212,165,116,0.1); border:1px solid rgba(212,165,116,0.15); border-radius:20px 20px 20px 4px; }
        .message.user { align-self:flex-end; background:rgba(160,184,156,0.15); border:1px solid rgba(160,184,156,0.2); border-radius:20px 20px 4px 20px; }
        
        .message p { font-size:0.95rem; line-height:1.7; margin:0; }
        .message.assistant p { color:var(--cream); }
        .message.user p { color:var(--cream); }
        
        .typing-indicator { display:flex; gap:4px; padding:1rem 1.25rem; background:rgba(212,165,116,0.1); border:1px solid rgba(212,165,116,0.15); border-radius:20px 20px 20px 4px; max-width:80px; }
        .typing-dot { width:8px; height:8px; background:var(--gold); border-radius:50%; animation:typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay:0.2s; }
        .typing-dot:nth-child(3) { animation-delay:0.4s; }
        @keyframes typing { 0%,60%,100%{transform:translateY(0)} 30%{transform:translateY(-5px)} }

        /* Input Area */
        .chat-input-area { display:flex; gap:1rem; align-items:flex-end; }
        .chat-input-wrapper { flex:1; position:relative; }
        .chat-input { width:100%; padding:1rem 1.25rem; background:rgba(22,22,22,0.9); border:1px solid rgba(212,165,116,0.15); border-radius:16px; color:var(--cream); font-family:var(--font-body); font-size:0.95rem; resize:none; min-height:54px; max-height:150px; transition:border-color 0.3s; }
        .chat-input:focus { outline:none; border-color:var(--gold); }
        .chat-input::placeholder { color:var(--text-muted); }
        
        .send-btn { width:54px; height:54px; background:linear-gradient(135deg,var(--gold) 0%,var(--gold-light) 100%); border:none; border-radius:16px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.3s; flex-shrink:0; }
        .send-btn:hover { transform:translateY(-2px); box-shadow:0 10px 30px var(--glow-gold); }
        .send-btn:active { transform:translateY(0); }
        .send-btn svg { width:24px; height:24px; color:var(--bg-deep); }
        .send-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; box-shadow:none; }

        /* Suggestions */
        .suggestions { display:flex; flex-wrap:wrap; gap:0.75rem; justify-content:center; margin-top:1.5rem; }
        .suggestion-btn { padding:0.6rem 1rem; background:rgba(212,165,116,0.08); border:1px solid rgba(212,165,116,0.15); border-radius:100px; color:var(--text-secondary); font-size:0.85rem; cursor:pointer; transition:all 0.3s; }
        .suggestion-btn:hover { background:rgba(212,165,116,0.15); color:var(--gold); border-color:var(--gold); }

        /* Quick Replies in messages */
        .quick-replies { display:flex; flex-wrap:wrap; gap:0.5rem; margin-top:1rem; padding-top:0.875rem; border-top:1px solid rgba(212,165,116,0.1); }
        .quick-btn { background:rgba(250,248,245,0.95); border:1px solid rgba(212,165,116,0.3); padding:0.5rem 1rem; border-radius:100px; font-size:0.85rem; color:#2D2A26; font-weight:500; cursor:pointer; transition:all 0.25s; font-family:inherit; }
        .quick-btn:hover { background:var(--gold); color:var(--bg-deep); transform:translateY(-2px); }

        /* Summary Card */
        .summary-card { background:linear-gradient(155deg, #2D2A26 0%, #3a3632 50%, #2D2A26 100%); border-radius:16px; padding:1.5rem; margin-top:1rem; color:var(--cream); position:relative; overflow:hidden; }
        .summary-card::before { content:''; position:absolute; top:0; right:0; width:120px; height:120px; background:radial-gradient(circle, rgba(212,165,116,0.15) 0%, transparent 70%); pointer-events:none; }
        .summary-header { display:flex; align-items:center; gap:0.5rem; color:var(--gold); font-size:0.95rem; font-weight:500; margin-bottom:1.25rem; }
        .summary-section { margin-bottom:1rem; padding-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.08); }
        .summary-section:last-of-type { border-bottom:none; margin-bottom:0; }
        .summary-title { font-size:0.75rem; color:var(--gold-light); text-transform:uppercase; letter-spacing:0.08em; margin-bottom:0.5rem; }
        .summary-row { padding:0.4rem 0; display:flex; flex-direction:column; gap:0.2rem; }
        .summary-row .label { font-size:0.75rem; color:rgba(255,255,255,0.5); }
        .summary-row .value { font-size:0.9rem; color:var(--cream); line-height:1.5; }

        /* Contact Form in Summary */
        .contact-form { margin-top:1.25rem; padding-top:1.25rem; border-top:1px solid rgba(255,255,255,0.1); }
        .form-label { font-size:0.85rem; color:rgba(255,255,255,0.8); margin-bottom:1rem; }
        .form-input { width:100%; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); border-radius:8px; padding:0.875rem 1rem; color:var(--cream); font-family:inherit; font-size:0.9rem; margin-bottom:0.75rem; transition:all 0.2s; }
        .form-input::placeholder { color:rgba(255,255,255,0.4); }
        .form-input:focus { outline:none; border-color:var(--gold); background:rgba(255,255,255,0.12); }
        .submit-btn { width:100%; background:linear-gradient(135deg, var(--gold), var(--gold-light)); color:var(--bg-deep); border:none; border-radius:8px; padding:1rem; font-family:inherit; font-size:0.95rem; font-weight:600; cursor:pointer; transition:all 0.25s; margin-top:0.5rem; }
        .submit-btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(212,165,116,0.3); }
        .submit-btn:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
        .privacy-hint { font-size:0.75rem; color:rgba(255,255,255,0.5); text-align:center; margin-top:0.75rem; }

        /* Success State */
        .success-state { text-align:center; padding:1.5rem 0; }
        .success-icon { width:56px; height:56px; background:linear-gradient(135deg, #22c55e, #16a34a); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 1rem; font-size:1.5rem; color:white; }
        .success-state h4 { font-size:1.1rem; margin-bottom:0.5rem; color:var(--gold); }
        .success-state p { font-size:0.9rem; color:rgba(255,255,255,0.8); line-height:1.6; }

        /* Error State */
        .error-state { text-align:center; padding:1rem; background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); border-radius:8px; margin-top:0.75rem; }
        .error-state p { font-size:0.85rem; color:#fca5a5; }

        /* Disclaimer */
        .disclaimer { text-align:center; padding:1.5rem 4vw; margin-top:auto; }
        .disclaimer p { font-size:0.8rem; color:var(--text-muted); max-width:600px; margin:0 auto; }

        /* Footer */
        footer { padding:2rem 4vw; border-top:1px solid rgba(212,165,116,0.1); text-align:center; }
        .footer-links { display:flex; justify-content:center; gap:2rem; margin-bottom:1rem; flex-wrap:wrap; }
        .footer-links a { color:var(--text-muted); text-decoration:none; font-size:0.85rem; transition:color 0.3s; }
        .footer-links a:hover { color:var(--gold); }
        .footer-copy { font-size:0.8rem; color:var(--text-muted); }

        /* Mobile */
        @media (max-width:600px) {
            .chat-window { min-height:300px; max-height:50vh; }
            .chat-lang-selector { flex-wrap:wrap; }
            .suggestion-btn { font-size:0.8rem; padding:0.5rem 0.8rem; }
        }
    </style>
</head>
<body data-lang="zh-TW">
    <div class="ambient">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

        <nav class="nav">
        <a href="index.html" class="nav-logo">SPACE BETWEEN</a>
        <div class="nav-right">
            <ul class="nav-links">
                <li><a href="about.html">
                    <span class="lang-content active" data-lang-content="zh-TW">é—œæ–¼</span>
                    <span class="lang-content" data-lang-content="zh-CN">å…³äº</span>
                    <span class="lang-content" data-lang-content="en">About</span>
                </a></li>
                <li><a href="services.html">
                    <span class="lang-content active" data-lang-content="zh-TW">æœå‹™</span>
                    <span class="lang-content" data-lang-content="zh-CN">æœåŠ¡</span>
                    <span class="lang-content" data-lang-content="en">Services</span>
                </a></li>
                <li><a href="portfolio.html">
                    <span class="lang-content active" data-lang-content="zh-TW">ä½œå“</span>
                    <span class="lang-content" data-lang-content="zh-CN">ä½œå“</span>
                    <span class="lang-content" data-lang-content="en">Works</span>
                </a></li>
                <li><a href="lounge.html">
                    <span class="lang-content active" data-lang-content="zh-TW">ç™‚ç™’å¯¦é©—å®¤</span>
                    <span class="lang-content" data-lang-content="zh-CN">ç–—æ„ˆå®éªŒå®¤</span>
                    <span class="lang-content" data-lang-content="en">Healing Lab</span>
                </a></li>
                <li><a href="ai-assistant.html" class="active">
                    <span class="lang-content active" data-lang-content="zh-TW">AI æ™ºèƒ½åˆ†æåŠ©ç†</span>
                    <span class="lang-content" data-lang-content="zh-CN">AI æ™ºèƒ½åˆ†æåŠ©ç†</span>
                    <span class="lang-content" data-lang-content="en">AI Assistant</span>
                </a></li>
                <li><a href="contact.html">
                    <span class="lang-content active" data-lang-content="zh-TW">è¯çµ¡</span>
                    <span class="lang-content" data-lang-content="zh-CN">è”ç»œ</span>
                    <span class="lang-content" data-lang-content="en">Contact</span>
                </a></li>
            </ul>
            <div class="lang-selector">
                <button class="lang-btn">
                    <span class="current-lang">ç¹ä¸­</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <div class="lang-dropdown">
                    <button class="lang-option active" data-lang="zh-TW">ğŸ‡­ğŸ‡° ç¹é«”ä¸­æ–‡</button>
                    <button class="lang-option" data-lang="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</button>
                    <button class="lang-option" data-lang="en">ğŸŒ English</button>
                </div>
            </div>
            <button class="mobile-toggle" aria-label="Menu">
                <span></span><span></span><span></span>
            </button>
        </div>
    </nav>

    <main class="main-container">
        <header class="page-header">
            <div class="assistant-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/>
                </svg>
            </div>
            <div class="lang-content active" data-lang-content="zh-TW">
                <h1 class="page-title zh">AI æ™ºèƒ½åˆ†æåŠ©ç† <span class="highlight">å…‰å…‰</span></h1>
                <p class="page-subtitle zh">ä½ çš„ 24 å°æ™‚ AI å“ç‰Œåˆ†æå¤¥ä¼´ï¼Œéš¨æ™‚ç‚ºä½ è§£ç­”å“ç‰Œå›°æƒ‘ã€‚</p>
            </div>
            <div class="lang-content" data-lang-content="zh-CN">
                <h1 class="page-title zh">AI æ™ºèƒ½åˆ†æåŠ©ç† <span class="highlight">å…‰å…‰</span></h1>
                <p class="page-subtitle zh">ä½ çš„ 24 å°æ—¶ AI å“ç‰Œåˆ†æä¼™ä¼´ï¼Œéšæ—¶ä¸ºä½ è§£ç­”å“ç‰Œå›°æƒ‘ã€‚</p>
            </div>
            <div class="lang-content" data-lang-content="en">
                <h1 class="page-title">AI <span class="highlight">Light Guide</span></h1>
                <p class="page-subtitle">Your 24/7 brand healing partner, always here to answer your brand questions.</p>
            </div>
        </header>

        <!-- Chat Language Selector -->
        <div class="chat-lang-selector">
            <button class="chat-lang-btn active" data-chat-lang="zh-TW">ç¹é«”ä¸­æ–‡</button>
            <button class="chat-lang-btn" data-chat-lang="zh-CN">ç®€ä½“ä¸­æ–‡</button>
            <button class="chat-lang-btn" data-chat-lang="en">English</button>
        </div>

        <div class="chat-container">
            <div class="chat-window" id="chatWindow">
                <div class="chat-messages" id="chatMessages">
                    <!-- Welcome message will be inserted here -->
                </div>
            </div>

            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" placeholder="è¼¸å…¥ä½ çš„å“ç‰Œå•é¡Œ..." rows="1"></textarea>
                </div>
                <button class="send-btn" id="sendBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>

            <div class="suggestions" id="suggestions">
                <!-- Suggestions will be inserted here -->
            </div>
        </div>

        <div class="disclaimer">
            <div class="lang-content active" data-lang-content="zh-TW">
                <p class="zh">AI åŠ©å…‰å…‰æä¾›çš„æ˜¯åˆæ­¥å“ç‰Œå»ºè­°ï¼Œå¦‚éœ€æ·±å…¥è«®è©¢è«‹è¯ç¹«æˆ‘å€‘çš„å°ˆæ¥­åœ˜éšŠã€‚</p>
            </div>
            <div class="lang-content" data-lang-content="zh-CN">
                <p class="zh">AI åŠ©å…‰å…‰æä¾›çš„æ˜¯åˆæ­¥å“ç‰Œå»ºè®®ï¼Œå¦‚éœ€æ·±å…¥å’¨è¯¢è¯·è”ç³»æˆ‘ä»¬çš„ä¸“ä¸šå›¢é˜Ÿã€‚</p>
            </div>
            <div class="lang-content" data-lang-content="en">
                <p>AI Light Guide provides preliminary brand suggestions. For in-depth consultation, please contact our professional team.</p>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-links">
            <a href="privacy.html">Privacy</a>
            <a href="terms.html">Terms</a>
            <a href="contact.html">Contact</a>
        </div>
        <p class="footer-copy">Â© 2025 Space Between Healing</p>
    </footer>

    <script>
        // ========== CONFIG ==========
        const API_ENDPOINT = 'https://spacebetween.app.n8n.cloud/webhook/healing-chat';
        const HUBSPOT_ENDPOINT = 'https://spacebetween.app.n8n.cloud/webhook/hubspot-lead';

        // ========== STATE ==========
        let history = [];
        let hasSummary = false;
        let currentChatLang = 'zh-TW';
        let lastSummaryData = null; // Store summary for HubSpot

        // ========== DOM ==========
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatWindow = document.getElementById('chatWindow');
        const suggestionsContainer = document.getElementById('suggestions');
        const chatLangBtns = document.querySelectorAll('.chat-lang-btn');
        const langSelector = document.querySelector('.lang-selector');
        const langBtn = document.querySelector('.lang-btn');
        const langOptions = document.querySelectorAll('.lang-option');
        const currentLangSpan = document.querySelector('.current-lang');

        // ========== LANGUAGE CONTENT ==========
        const langLabels = { 'zh-TW': 'ç¹', 'zh-CN': 'ç®€', 'en': 'EN' };
        
        const chatContent = {
            'zh-TW': {
                welcome: 'ä½ å¥½ï¼æˆ‘æ˜¯åŠ©å…‰å…‰ âœ¨\n\næ­¡è¿ä¾†åˆ°å“ç‰Œç™‚ç™’å¯¦é©—å®¤ã€‚æˆ‘æ˜¯ AI é©…å‹•çš„å“ç‰Œæƒ…ç·’è¨ºæ–·ç³»çµ±ï¼Œæœƒé€éå°è©±å¹«ä½ é‡æ¸…å“ç‰Œç‹€æ…‹ã€‚\n\næº–å‚™å¥½é–‹å§‹è¨ºæ–·äº†å—ï¼Ÿ',
                placeholder: 'èªªèªªä½ çš„å“ç‰Œå›°æ“¾...',
                suggestions: ['æˆ‘çš„å“ç‰Œå¥½åƒæœ‰é»å•é¡Œ...', 'æƒ³äº†è§£è¨ºæ–·æµç¨‹', 'ä¸ç¢ºå®šè‡ªå·±éœ€è¦ä»€éº¼'],
                error: 'æŠ±æ­‰ï¼Œè¨ºæ–·ç³»çµ±æš«æ™‚ç„¡æ³•å›æ‡‰ ğŸ˜”\nè«‹ç¨å¾Œå†è©¦ï¼Œæˆ–ç›´æ¥è¯ç¹«ï¼šhello@spacebetweenhealing.com',
                formSuccess: 'è¨ºæ–·å ±å‘Šå·²é€å‡ºï¼',
                formSuccessDesc: 'è¨­è¨ˆå¸«æœƒåœ¨ 1-2 å€‹å·¥ä½œå¤©å…§å›è¦†ä½  âœ¨',
                formError: 'é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ç›´æ¥è¯ç¹« hello@spacebetweenhealing.com',
                formSubmitting: 'è™•ç†ä¸­...',
                formSubmit: 'é€å‡ºè¨ºæ–·å ±å‘Šçµ¦è¨­è¨ˆå¸«'
            },
            'zh-CN': {
                welcome: 'ä½ å¥½ï¼æˆ‘æ˜¯åŠ©å…‰å…‰ âœ¨\n\næ¬¢è¿æ¥åˆ°å“ç‰Œç–—æ„ˆå®éªŒå®¤ã€‚æˆ‘æ˜¯ AI é©±åŠ¨çš„å“ç‰Œæƒ…ç»ªè¯Šæ–­ç³»ç»Ÿï¼Œä¼šé€šè¿‡å¯¹è¯å¸®ä½ å˜æ¸…å“ç‰ŒçŠ¶æ€ã€‚\n\nå‡†å¤‡å¥½å¼€å§‹è¯Šæ–­äº†å—ï¼Ÿ',
                placeholder: 'è¯´è¯´ä½ çš„å“ç‰Œå›°æ‰°...',
                suggestions: ['æˆ‘çš„å“ç‰Œå¥½åƒæœ‰ç‚¹é—®é¢˜...', 'æƒ³äº†è§£è¯Šæ–­æµç¨‹', 'ä¸ç¡®å®šè‡ªå·±éœ€è¦ä»€ä¹ˆ'],
                error: 'æŠ±æ­‰ï¼Œè¯Šæ–­ç³»ç»Ÿæš‚æ—¶æ— æ³•å›åº” ğŸ˜”\nè¯·ç¨åå†è¯•ï¼Œæˆ–ç›´æ¥è”ç³»ï¼šhello@spacebetweenhealing.com',
                formSuccess: 'è¯Šæ–­æŠ¥å‘Šå·²é€å‡ºï¼',
                formSuccessDesc: 'è®¾è®¡å¸ˆä¼šåœ¨ 1-2 ä¸ªå·¥ä½œå¤©å†…å›å¤ä½  âœ¨',
                formError: 'é€å‡ºå¤±è´¥ï¼Œè¯·ç¨åå†è¯•æˆ–ç›´æ¥è”ç³» hello@spacebetweenhealing.com',
                formSubmitting: 'å¤„ç†ä¸­...',
                formSubmit: 'é€å‡ºè¯Šæ–­æŠ¥å‘Šç»™è®¾è®¡å¸ˆ'
            },
            'en': {
                welcome: 'Hello! I\'m Light Guide âœ¨\n\nWelcome to the Brand Healing Lab. I\'m an AI-powered brand emotion diagnostic system that helps you understand your brand\'s state through conversation.\n\nReady to start the diagnosis?',
                placeholder: 'Tell me about your brand concerns...',
                suggestions: ['My brand seems to have some issues...', 'Want to know the process', 'Not sure what I need'],
                error: 'Sorry, the system is temporarily unavailable ğŸ˜”\nPlease try again later or contact: hello@spacebetweenhealing.com',
                formSuccess: 'Report submitted!',
                formSuccessDesc: 'Our designer will respond within 1-2 business days âœ¨',
                formError: 'Submission failed. Please try again or contact hello@spacebetweenhealing.com',
                formSubmitting: 'Submitting...',
                formSubmit: 'Submit report to designer'
            }
        };

        // ========== HELPERS ==========
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatText(text) {
            return escapeHtml(text)
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
        }

        function parseSummary(text) {
            const m = text.match(/---SUMMARY_START---([\s\S]*?)---SUMMARY_END---/);
            if (!m) return null;
            const content = m[1].trim();
            const data = {};
            const patterns = [
                { key: 'ç”¢æ¥­/æœå‹™', regex: /ç”¢æ¥­\/æœå‹™[ï¼š:]\s*(.+)/i },
                { key: 'ç›®æ¨™å®¢ç¾¤', regex: /ç›®æ¨™å®¢ç¾¤[ï¼š:]\s*(.+)/i },
                { key: 'å“ç‰Œå¹´é½¡', regex: /å“ç‰Œå¹´é½¡[ï¼š:]\s*(.+)/i },
                { key: 'ç”¨æˆ¶æ„Ÿå—', regex: /ç”¨æˆ¶æ„Ÿå—[ï¼š:]\s*(.+)/i },
                { key: 'æƒ…ç·’é—œéµè©', regex: /æƒ…ç·’é—œéµè©[ï¼š:]\s*(.+)/i },
                { key: 'ä¸»è¦å•é¡Œç¶­åº¦', regex: /ä¸»è¦å•é¡Œç¶­åº¦[ï¼š:]\s*(.+)/i },
                { key: 'å…·é«”å¾µå…†', regex: /å…·é«”å¾µå…†[ï¼š:]\s*(.+)/i },
                { key: 'ç™‚ç™’æ–¹å‘', regex: /ç™‚ç™’æ–¹å‘[ï¼š:]\s*(.+)/i },
                { key: 'å„ªå…ˆè™•ç†', regex: /å„ªå…ˆè™•ç†[ï¼š:]\s*(.+)/i },
                { key: 'å‚™è¨»', regex: /å‚™è¨»[ï¼š:]\s*(.+)/i },
                { key: 'ç›®å‰å›°æ“¾', regex: /ç›®å‰å›°æ“¾[ï¼š:]\s*(.+)/i },
                { key: 'æœŸæœ›ç›®æ¨™', regex: /æœŸæœ›ç›®æ¨™[ï¼š:]\s*(.+)/i }
            ];
            patterns.forEach(p => {
                const match = content.match(p.regex);
                if (match) data[p.key] = match[1].trim();
            });
            return Object.keys(data).length ? data : null;
        }

        function scrollDown() {
            setTimeout(() => chatWindow.scrollTop = chatWindow.scrollHeight, 50);
        }

        // ========== RENDER ==========
        function addMessage(content, role, opts = {}) {
            console.log('Adding message:', role, content.substring(0, 50) + '...');
            
            if (!chatMessages) {
                console.error('chatMessages element not found!');
                return;
            }
            
            const div = document.createElement('div');
            div.className = `message ${role}`;
            
            const summary = parseSummary(content);
            let displayText = content.replace(/---SUMMARY_START---[\s\S]*?---SUMMARY_END---/, '').trim();
            let extra = '';

            // Quick replies
            if (opts.quickReplies?.length) {
                extra += '<div class="quick-replies">' + 
                    opts.quickReplies.map(r => `<button class="quick-btn" onclick="quickSend('${r.replace(/'/g, "\\'")}')">${r}</button>`).join('') + 
                '</div>';
            }

            // Summary card
            if (summary && !hasSummary) {
                hasSummary = true;
                lastSummaryData = summary; // Store for HubSpot
                extra += renderSummaryCard(summary);
            }

            div.innerHTML = `<p>${formatText(displayText)}</p>${extra}`;
            chatMessages.appendChild(div);
            scrollDown();
        }

        function renderSummaryCard(summary) {
            return `
            <div class="summary-card" id="summaryCard">
                <div class="summary-header">ğŸ“‹ å“ç‰Œåˆæ­¥è¨ºæ–·å ±å‘Š</div>
                ${summary['ç”¢æ¥­/æœå‹™'] || summary['ç›®æ¨™å®¢ç¾¤'] ? `
                <div class="summary-section">
                    <div class="summary-title">åŸºæœ¬è³‡æ–™</div>
                    ${summary['ç”¢æ¥­/æœå‹™'] ? `<div class="summary-row"><span class="label">ç”¢æ¥­/æœå‹™</span><span class="value">${summary['ç”¢æ¥­/æœå‹™']}</span></div>` : ''}
                    ${summary['ç›®æ¨™å®¢ç¾¤'] ? `<div class="summary-row"><span class="label">ç›®æ¨™å®¢ç¾¤</span><span class="value">${summary['ç›®æ¨™å®¢ç¾¤']}</span></div>` : ''}
                </div>` : ''}
                ${summary['ç”¨æˆ¶æ„Ÿå—'] || summary['æƒ…ç·’é—œéµè©'] ? `
                <div class="summary-section">
                    <div class="summary-title">æƒ…ç·’ç‹€æ…‹</div>
                    ${summary['ç”¨æˆ¶æ„Ÿå—'] ? `<div class="summary-row"><span class="label">æ„Ÿå—</span><span class="value">${summary['ç”¨æˆ¶æ„Ÿå—']}</span></div>` : ''}
                    ${summary['æƒ…ç·’é—œéµè©'] ? `<div class="summary-row"><span class="label">é—œéµè©</span><span class="value">${summary['æƒ…ç·’é—œéµè©']}</span></div>` : ''}
                </div>` : ''}
                ${summary['ä¸»è¦å•é¡Œç¶­åº¦'] || summary['å…·é«”å¾µå…†'] || summary['ç›®å‰å›°æ“¾'] ? `
                <div class="summary-section">
                    <div class="summary-title">è¨ºæ–·ç™¼ç¾</div>
                    ${summary['ä¸»è¦å•é¡Œç¶­åº¦'] ? `<div class="summary-row"><span class="label">å•é¡Œç¶­åº¦</span><span class="value">${summary['ä¸»è¦å•é¡Œç¶­åº¦']}</span></div>` : ''}
                    ${summary['å…·é«”å¾µå…†'] || summary['ç›®å‰å›°æ“¾'] ? `<div class="summary-row"><span class="label">å…·é«”å¾µå…†</span><span class="value">${summary['å…·é«”å¾µå…†'] || summary['ç›®å‰å›°æ“¾']}</span></div>` : ''}
                </div>` : ''}
                ${summary['ç™‚ç™’æ–¹å‘'] || summary['å„ªå…ˆè™•ç†'] || summary['æœŸæœ›ç›®æ¨™'] ? `
                <div class="summary-section">
                    <div class="summary-title">åˆæ­¥å»ºè­°</div>
                    ${summary['ç™‚ç™’æ–¹å‘'] ? `<div class="summary-row"><span class="label">ç™‚ç™’æ–¹å‘</span><span class="value">${summary['ç™‚ç™’æ–¹å‘']}</span></div>` : ''}
                    ${summary['å„ªå…ˆè™•ç†'] || summary['æœŸæœ›ç›®æ¨™'] ? `<div class="summary-row"><span class="label">å„ªå…ˆè™•ç†</span><span class="value">${summary['å„ªå…ˆè™•ç†'] || summary['æœŸæœ›ç›®æ¨™']}</span></div>` : ''}
                </div>` : ''}
                <div class="contact-form" id="contactForm">
                    <p class="form-label">ç•™ä¸‹è¯ç¹«æ–¹å¼ï¼Œè¨­è¨ˆå¸«æœƒæ ¹æ“šè¨ºæ–·çµæœè·Ÿé€²ï¼š</p>
                    <input type="text" class="form-input" id="userName" placeholder="ä½ çš„åå­—">
                    <input type="email" class="form-input" id="userEmail" placeholder="Email">
                    <input type="tel" class="form-input" id="userPhone" placeholder="WhatsAppï¼ˆé¸å¡«ï¼‰">
                    <button class="submit-btn" id="submitBtn" onclick="submitForm()">${chatContent[currentChatLang].formSubmit}</button>
                    <p class="privacy-hint">ğŸ”’ è³‡æ–™åƒ…ç”¨æ–¼è¨­è¨ˆå¸«è¯ç¹«</p>
                    <div id="formMessage"></div>
                </div>
            </div>`;
        }

        function showTyping() {
            const div = document.createElement('div');
            div.className = 'typing-indicator';
            div.id = 'typingIndicator';
            div.innerHTML = '<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>';
            chatMessages.appendChild(div);
            scrollDown();
        }

        function hideTyping() {
            const el = document.getElementById('typingIndicator');
            if (el) el.remove();
        }

        // ========== API ==========
        async function callAPI(userMsg) {
            // Add language instruction for non-Chinese
            let msgToSend = userMsg;
            if (currentChatLang === 'en') {
                msgToSend = `[Please respond in English] ${userMsg}`;
            } else if (currentChatLang === 'zh-CN') {
                msgToSend = `[è«‹ç”¨ç°¡é«”ä¸­æ–‡å›è¦†] ${userMsg}`;
            }
            
            history.push({ role: 'user', content: msgToSend });
            
            console.log('Calling API:', API_ENDPOINT);
            
            try {
                const res = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        body: { message: msgToSend }
                    })
                });
                
                console.log('API Response status:', res.status);
                
                if (!res.ok) {
                    console.error('API error status:', res.status);
                    throw new Error('API error: ' + res.status);
                }
                
                const data = await res.json();
                console.log('API Response data:', data);
                
                const reply = data.reply || data.content?.[0]?.text || chatContent[currentChatLang].error;
                history.push({ role: 'assistant', content: reply });
                return reply;
            } catch (e) {
                console.error('API Error:', e);
                return chatContent[currentChatLang].error;
            }
        }

        // ========== ACTIONS ==========
        async function sendMessage(text = null) {
            const msg = text || chatInput.value.trim();
            if (!msg) return;
            
            addMessage(msg, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';
            sendBtn.disabled = true;
            suggestionsContainer.style.display = 'none';
            
            showTyping();
            const reply = await callAPI(msg);
            hideTyping();
            
            addMessage(reply, 'assistant');
            sendBtn.disabled = false;
        }

        function quickSend(text) {
            sendMessage(text);
        }

        // ========== SUBMIT TO HUBSPOT VIA N8N ==========
        async function submitForm() {
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const btn = document.getElementById('submitBtn');
            const formMessage = document.getElementById('formMessage');
            
            // Validation
            if (!name || !email) {
                formMessage.innerHTML = '<div class="error-state"><p>è«‹å¡«å¯«åå­—å’Œ Email</p></div>';
                return;
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                formMessage.innerHTML = '<div class="error-state"><p>è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email</p></div>';
                return;
            }
            
            // Disable button
            btn.disabled = true;
            btn.textContent = chatContent[currentChatLang].formSubmitting;
            formMessage.innerHTML = '';
            
            // Build conversation log
            const conversationLog = history.map(m => 
                `[${m.role === 'user' ? 'è¨ªå®¢' : 'å…‰å…‰'}] ${m.content}`
            ).join('\n\n');
            
            // Prepare data for n8n/HubSpot
            const payload = {
                // Contact info
                name: name,
                email: email,
                phone: phone || '',
                
                // Summary data
                summary: lastSummaryData || {},
                
                // Additional context
                industry: lastSummaryData?.['ç”¢æ¥­/æœå‹™'] || '',
                targetAudience: lastSummaryData?.['ç›®æ¨™å®¢ç¾¤'] || '',
                mainIssue: lastSummaryData?.['ä¸»è¦å•é¡Œç¶­åº¦'] || lastSummaryData?.['ç›®å‰å›°æ“¾'] || '',
                healingDirection: lastSummaryData?.['ç™‚ç™’æ–¹å‘'] || '',
                priority: lastSummaryData?.['å„ªå…ˆè™•ç†'] || lastSummaryData?.['æœŸæœ›ç›®æ¨™'] || '',
                emotionKeywords: lastSummaryData?.['æƒ…ç·’é—œéµè©'] || '',
                
                // Conversation
                conversationLog: conversationLog,
                
                // Meta
                language: currentChatLang,
                source: 'ai-assistant',
                timestamp: new Date().toISOString()
            };
            
            console.log('Submitting to HubSpot via n8n:', payload);
            
            try {
                const res = await fetch(HUBSPOT_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                console.log('HubSpot webhook response:', res.status);
                
                if (res.ok) {
                    // Success - show success state
                    const card = document.getElementById('summaryCard');
                    const contactForm = document.getElementById('contactForm');
                    
                    if (contactForm) {
                        contactForm.innerHTML = `
                            <div class="success-state">
                                <div class="success-icon">âœ“</div>
                                <h4>${chatContent[currentChatLang].formSuccess}</h4>
                                <p>${chatContent[currentChatLang].formSuccessDesc}</p>
                            </div>
                        `;
                    }
                    scrollDown();
                } else {
                    throw new Error('HubSpot API error: ' + res.status);
                }
            } catch (e) {
                console.error('HubSpot submit error:', e);
                btn.disabled = false;
                btn.textContent = chatContent[currentChatLang].formSubmit;
                formMessage.innerHTML = `<div class="error-state"><p>${chatContent[currentChatLang].formError}</p></div>`;
            }
        }

        // ========== LANGUAGE SWITCHING ==========
        function setLanguage(lang) {
            document.body.setAttribute('data-lang', lang);
            localStorage.setItem('preferred-lang', lang);
            currentLangSpan.textContent = langLabels[lang];
            langOptions.forEach(opt => opt.classList.toggle('active', opt.dataset.lang === lang));
            document.querySelectorAll('.lang-content').forEach(el => {
                el.classList.toggle('active', el.getAttribute('data-lang-content') === lang);
            });
            langSelector.classList.remove('open');
        }

        function setChatLang(lang) {
            console.log('Setting chat language to:', lang);
            currentChatLang = lang;
            chatLangBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.chatLang === lang));
            if (chatInput) chatInput.placeholder = chatContent[lang].placeholder;
            
            // Reset chat
            if (chatMessages) chatMessages.innerHTML = '';
            history = [];
            hasSummary = false;
            lastSummaryData = null;
            
            // Show welcome
            console.log('Showing welcome message');
            addMessage(chatContent[lang].welcome, 'assistant', {
                quickReplies: chatContent[lang].suggestions
            });
            
            // Update suggestions
            if (suggestionsContainer) {
                suggestionsContainer.innerHTML = chatContent[lang].suggestions.map(s => 
                    `<button class="suggestion-btn" onclick="quickSend('${s.replace(/'/g, "\\'")}')">${s}</button>`
                ).join('');
                suggestionsContainer.style.display = 'flex';
            }
        }

        // ========== EVENT LISTENERS ==========
        if (langBtn) langBtn.addEventListener('click', () => langSelector.classList.toggle('open'));
        document.addEventListener('click', e => {
            if (langSelector && !langSelector.contains(e.target)) langSelector.classList.remove('open');
        });
        langOptions.forEach(opt => opt.addEventListener('click', () => setLanguage(opt.dataset.lang)));
        chatLangBtns.forEach(btn => btn.addEventListener('click', () => setChatLang(btn.dataset.chatLang)));

        if (sendBtn) sendBtn.addEventListener('click', () => sendMessage());
        if (chatInput) {
            chatInput.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (chatInput.value.trim()) sendMessage();
                }
            });
            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = Math.min(chatInput.scrollHeight, 150) + 'px';
                if (sendBtn) sendBtn.disabled = !chatInput.value.trim();
            });
        }

        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AI Assistant initialized');
            const savedLang = localStorage.getItem('preferred-lang') || 'zh-TW';
            setLanguage(savedLang);
            setChatLang(savedLang);
        });

        // Fallback init if DOMContentLoaded already fired
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            console.log('AI Assistant fallback init');
            const savedLang = localStorage.getItem('preferred-lang') || 'zh-TW';
            setLanguage(savedLang);
            setChatLang(savedLang);
        }
    </script>
</body>
</html>
